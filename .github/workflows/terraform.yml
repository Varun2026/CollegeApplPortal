name: Terraform
on:
push:
paths:
- 'infra/**'


jobs:
terraform:
runs-on: ubuntu-latest
steps:
- name: Checkout
uses: actions/checkout@v4


- name: Setup Terraform
uses: hashicorp/setup-terraform@v2
with:
terraform_version: 1.5.7


- name: Terraform Init
run: |
cd infra/terraform
terraform init


- name: Terraform Plan
run: |
cd infra/terraform
terraform plan -out=tfplan


- name: Terraform Apply
if: github.ref == 'refs/heads/main'
run: |
cd infra/terraform
terraform apply -auto-approve tfplan